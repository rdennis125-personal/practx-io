# yaml-language-server: $schema=https://github.com/Azure/deployment-environments/releases/download/2022-11-11-preview/manifest.
# schema.json

name: practx-functions
summary: Deploys a consumption-based Azure Functions app for Practx.io background processing.
description: |
  Creates an event-driven Azure Functions app on the Dynamic (Y1) plan configured for Practx.io. The
  deployment wires the app to Application Insights, an existing storage account, and the shared Key Vault
  that provides required application secrets.

runner: Bicep
templatePath: main.bicep

parameters:
  - id: environmentType
    name: Environment type
    type: string
    description: Dev Center environment type this deployment is for.
    required: true
    allowed:
      - DEV
      - QA1
      - PROD

  - id: location
    name: Azure region
    type: string
    description: Azure region used to deploy the environment resources.
    default: westus2

  - id: baseName
    name: Resource base name
    type: string
    description: Base name combined with the environment type to create resource names.
    default: practx

  - id: storageAccountName
    name: Storage account name
    type: string
    description: Name of the storage account used for the Functions runtime.
    required: true

  - id: appInsightsConnectionString
    name: Application Insights connection string
    type: string
    description: Connection string used to emit telemetry.
    required: true
    secure: true

  - id: keyVaultId
    name: Key Vault resource ID
    type: string
    description: Resource ID for the Key Vault that stores application secrets.
    required: true

  - id: keyVaultName
    name: Key Vault name
    type: string
    description: Name of the Key Vault that stores application secrets.
    required: true
